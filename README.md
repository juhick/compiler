初步完成，尚剩余错误处理
